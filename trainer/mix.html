<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>単元横断ミックス出題</title>
<link rel="icon" href="/anki-project/assets/img/favicon.png" type="image/png">
<style>
  :root{--bg:#f7f7fb;--ink:#1f2937;--muted:#667085;--card:#fff;--border:#e5e7eb;--brand:#3b4675;}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,sans-serif}
  .wrap{max-width:960px;margin:28px auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin:14px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border:none}
  .muted{color:var(--muted)}
  .q{font-size:1.15rem;line-height:1.8}
  .answer{background:#f9fafb;border:1px dashed #cbd5e1;border-radius:10px;padding:12px;white-space:pre-wrap}
  .pill{display:inline-block;padding:.25em .6em;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:.8rem;margin-right:6px}
  img.fig{max-width:100%;border:1px solid var(--border);border-radius:10px}
</style>
</head>
<body>
<div class="wrap">
  <h1>単元横断ミックス出題</h1>
  <p class="muted">例：<code>?tags=図形,小4&limit=10&shuffle=true&need_review=true</code></p>

  <div id="controls" class="card">
    <div class="row">
      <input id="tagsInput" class="btn" style="flex:1" placeholder="タグ（例：図形,小4）">
      <input id="limitInput" class="btn" type="number" min="1" max="100" value="10" style="width:110px">
      <label><input id="shuffleInput" type="checkbox" checked> シャッフル</label>
      <label><input id="needReview" type="checkbox"> 復習優先</label>
      <label><input id="onlyLow" type="checkbox"> 苦手だけ</label>
      <label><input id="withImages" type="checkbox" checked> 図を表示</label>
      <button id="startBtn" class="btn primary">出題開始</button>
    </div>
    <div class="muted" id="sourceMeta" style="margin-top:8px"></div>
  </div>

  <div id="quizArea"></div>
</div>

<script src="/anki-project/trainer/assets/js/quiz-engine.js"></script>
<script>
  const q = new URLSearchParams(location.search);
  if(q.get("tags")) document.getElementById("tagsInput").value = q.get("tags");
  if(q.get("limit")) document.getElementById("limitInput").value = q.get("limit");
  if(q.get("shuffle")==="false") document.getElementById("shuffleInput").checked = false;
  if(q.get("need_review")==="true") document.getElementById("needReview").checked = true;
  if(q.get("only_low")==="true") document.getElementById("onlyLow").checked = true;

  async function start(){
    const tags = document.getElementById("tagsInput").value.trim();
    const limit = +document.getElementById("limitInput").value;
    const shuffle = document.getElementById("shuffleInput").checked;
    const needReview = document.getElementById("needReview").checked;
    const onlyLow = document.getElementById("onlyLow").checked;
    const withImages = document.getElementById("withImages").checked;
    const {count, used} = await QuizEngine.mount({
      container: "#quizArea",
      tags: tags ? tags.split(",").map(s=>s.trim()).filter(Boolean) : [],
      limit, shuffle, needReview, onlyLow, withImages
    });
    document.getElementById("sourceMeta").textContent = `読み込み：${used.length}ファイル / 出題：${count}問`;
  }
  document.getElementById("startBtn").onclick = start;

  if([...q.keys()].length) start();
</script>
</body>
</html>
