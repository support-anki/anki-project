<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="noindex,nofollow" />
<title>â™¥å­¦ç¿’ãƒãƒ¼ã‚¿ãƒ«â™¥</title>
<link rel="icon" href="/anki-project/assets/img/favicon.png" type="image/png">
<link rel="stylesheet" href="assets/css/style.css"/>
<style>
  /* æœ€ä½é™ã®è£œåŠ©ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ—¢å­˜ã® style.css ãŒå„ªå…ˆï¼‰ */
  .auto-title{margin:28px 16px 6px;font:700 18px/1.4 system-ui}
  .auto-wrap{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin:0 16px 28px}
  .auto-card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:14px}
  .auto-card h3{margin:0 0 6px;font:600 16px/1.4 system-ui}
  .auto-card .type{color:#6b7280;font:12px/1.6 system-ui;margin-bottom:6px}
  .auto-tags{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
  .auto-tag{border:1px solid #e5e7eb;border-radius:999px;padding:2px 8px;font:12px/1.8 system-ui}
  .auto-actions{margin-top:10px}
  .auto-link{color:#2563eb;text-decoration:none}
  .muted{color:#6b7280;font:12px/1.8 system-ui;margin:8px 16px}
</style>
</head>
<body>
<header class="site">
  <h1>â™¥å­¦ç¿’ãƒãƒ¼ã‚¿ãƒ«â™¥</h1>
  <p class="sub">ç©´åŸ‹ã‚ã‚„é¸æŠå•é¡Œï¼å¿…è¦æ™‚ <code>?edit=1</code> ã§åº§æ¨™ã‚’ãƒ”ãƒ³è¿½åŠ ã€‚</p>
</header>

<main class="grid">
  <!-- æ—¢å­˜ã®é™çš„ã‚«ãƒ¼ãƒ‰ï¼ˆãã®ã¾ã¾ï¼‰ -->
  <a class="card" href="modules/geo/index.html">
    <h2>ğŸŒ åœ°ç†æ•™æ ä¸€è¦§</h2>
    <p>ç”¨èªã€åœ°å›³ãªã©</p>
  </a>
  <a class="card" href="modules/sci/index.html">
    <h2>ğŸ”¬ ç†ç§‘æ•™æ ä¸€è¦§</h2><p>ç©´åŸ‹ã‚ã€é¸æŠå•é¡Œãªã©</p>
  </a>
  <a class="card" href="modules/jp/index.html">
    <h2>ğŸ“ å›½èªæ•™æ ä¸€è¦§</h2><p>æ¼¢å­—ãƒ»èªå½™</p>
  </a>
  <a class="card" href="modules/math/index.html">
    <h2>ğŸ”¢ ç®—æ•°æ•™æ ä¸€è¦§</h2>
    <p>å›³ãªã—ãƒ»å›³ã‚ã‚Šãƒ»ä¾‹é¡Œï¼é¡é¡Œãªã©</p>
  </a>
  <a class="card" href="trainer/mix.html">
    <h2>ğŸ§® å˜å…ƒæ¨ªæ–­ãƒŸãƒƒã‚¯ã‚¹å‡ºé¡Œ</h2>
    <p>è¤‡æ•°å˜å…ƒã‚’æ¨ªæ–­ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œï¼ˆã‚¿ã‚°é¸æŠå¯¾å¿œï¼‰</p>
  </a>
</main>

<!-- ã“ã“ã‹ã‚‰è‡ªå‹•ä¸€è¦§ï¼ˆmanifestçµåˆï¼‰ -->
<h2 class="auto-title">ğŸ“š æ•™æä¸€è¦§ï¼ˆè‡ªå‹•ï¼‰</h2>
<p class="muted" id="auto-note">å„ç§‘ç›®ã® manifest.json ã‚’çµåˆã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>
<section id="auto-list" class="auto-wrap" aria-live="polite"></section>

<footer class="site"><small>â€» noindexï¼ˆæ¤œç´¢é™¤å¤–ï¼‰</small></footer>

<script>
(async ()=>{
  const root = document.getElementById('auto-list');
  const note = document.getElementById('auto-note');

  // ç§‘ç›®ã”ã¨ã® manifestï¼ˆå­˜åœ¨ã—ãªã„ã‚‚ã®ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
  const sources = [
    '/anki-project/assets/data/sci/manifest.json',
    '/anki-project/assets/data/geo/manifest.json',
    '/anki-project/assets/data/jpn/manifest.json',
    '/anki-project/assets/data/math/manifest.json'
  ];

  async function fetchMaybe(u){
    try{
      const r = await fetch(u + '?t=' + Date.now());
      return r.ok ? await r.json() : [];
    }catch(_){ return []; }
  }

  // å–å¾— & çµåˆ
  const lists = await Promise.all(sources.map(fetchMaybe));
  let items = lists.flat();

  // é‡è¤‡æ’é™¤ï¼ˆpath or data ã‚’ã‚­ãƒ¼ã«ï¼‰
  const seen = new Set();
  items = items.filter(x=>{
    const key = (x.path || x.data || JSON.stringify(x));
    if(seen.has(key)) return false;
    seen.add(key);
    return true;
  });

  // ä¸¦ã³é †ï¼ˆæ›´æ–°æ—¥ãŒã‚ã‚Œã°æ–°ã—ã„é †ï¼‰
  items.sort((a,b)=>{
    const ta = Date.parse(a.updated||'')||0;
    const tb = Date.parse(b.updated||'')||0;
    return tb - ta;
  });

  // æç”»
  if(!items.length){
    note.textContent = 'ï¼ˆã¾ã è¡¨ç¤ºã§ãã‚‹æ•™æã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å„ç§‘ç›®ã® manifest.json ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰';
    return;
  }

  const html = items.map(x=>{
    const url = (x.path && x.path.startsWith('http')) ? x.path : (location.origin + (x.path||''));
    const tags = (x.tags||[]).map(t=>`<span class="auto-tag">${t}</span>`).join('');
    const type = x.type || (url.includes('modules/marker.html') ? 'marker' : 'html');
    const title = x.title || '(ç„¡é¡Œ)';
    return `
      <article class="auto-card">
        <h3>${title}</h3>
        <div class="type">${type}</div>
        <div class="auto-tags">${tags}</div>
        <div class="auto-actions"><a class="auto-link" href="${url}" target="_blank" rel="noopener">â–¶ é–‹ã</a></div>
      </article>
    `;
  }).join('');

  root.innerHTML = html;
})();
</script>
</body>
</html>
